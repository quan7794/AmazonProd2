const ATTRIBUTE_LABELS=["label","aria-label","data-label","data-fieldlabel","data-displaylabel"],PT_MULTISPACE=/\s+/g,PT_SKIP_CHARS=/[^A-Za-z0-9\s\-\.\?\(\)\[\]\{\},;]+/g,CSS_FORMS="form",CSS_DIRECT_LABELS="label[for],input[aria-labelledby],select[aria-labelledby],button[aria-labelledby],textarea[aria-labelledby],*[aria-labelledby][role=checkbox],*[aria-labelledby][role=radio],*[aria-labelledby][role=listbox],*[aria-labelledby][role=textbox],*[aria-labelledby][role=button]",CSS_DIRECT_INPUT_ELEMENTS="input,select,button,textarea",CSS_ROLE_BASED_INPUT_ELEMENTS="*[role=checkbox],*[role=radio],*[role=listbox],*[role=textbox],*[role=button]",SIBLING_LABEL_ELEMENTS="*[class*=label],*[class*=Label],*[class*=LABEL],*[class*=lbl],*[class*=Lbl],*[class*=LBL],*[name*=label],*[name*=Label],*[name*=LABEL],*[name*=lbl],*[name*=Lbl],*[name*=LBL]",ElementType=Object.freeze({TEXT:1,RADIO:2,CHECKBOX:3,SELECT:4,BUTTON:5,IMAGE:6,EMAIL:7,FILE:8,PHONE:9,ANCHOR:10,HIDDEN:11,OTHER:99}),LabelPreference=Object.freeze({LEFT:1,RIGHT:2,CENTER:3,NONE:99});function WebPage(a){if(!a instanceof HTMLDocument)throw new Error("InvalidArgumentError: WebPage constructor - param \"document\" should be of type HTMLDocument");this.document=a,this.directLabelMap=getDirectLabelMap.call(this)}WebPage.prototype.getLabel=function(a){if(!a instanceof HTMLElement)throw new Error("InvalidArgumentError: WebPage getLabel - param \"element\" should be of type HTMLElement");var b=getElementType(a),c=getLabelPreference(b);if(b===ElementType.HIDDEN||isElementHidden(a))return null;if(this.directLabelMap.has(a))return this.directLabelMap.get(a);for(var d=a;(d=d.parentElement)&&"form"!==d.tagName.toLowerCase(););var e,f;f=b===ElementType.ANCHOR?getAnchorLabel:b===ElementType.BUTTON?getButtonLabel:b===ElementType.RADIO||b===ElementType.CHECKBOX?getRadioLabel:null;var e=null===f?null:f(a);if(null!==e)return e;if(null!==d&&isFormElement(b)){for(var g,h,i=a;(i=i.parentElement)&&i!==d;)if((i.getAttribute("class")||"").indexOf("form-group")){var j=i.getElementsByTagName("label");0<j.length&&(h=j[0],g=textContent(h));break}if(isValidLabel(g))return{text:g,element:h}}if(c===LabelPreference.NONE){var k=getFirstAncestorByTagName(a,["a","button"]);if(null!==k)return f="a"===k.tagName.toLowerCase()?getAnchorLabel:getButtonLabel,f(k)}if(b===ElementType.IMAGE&&(e=getImageLabel(a),null!==e))return e;if(e=getAttributeLabel(a),null!==e)return e;var l=null!==d&&isFormElement(b)?d:null,m=getElementWrapper(a,l,c);return c===LabelPreference.NONE&&(g=textContent(a),isValidLabel(g))?{text:g,element:null}:(f=null,c===LabelPreference.scrollLeft||c===LabelPreference.NONE?f=getHeadText:c===LabelPreference.LEFT&&(f=getTailText),e=null===f?null:f(m),null!==e)?e:(e=getLabelFromSiblings(m,c),null!==e)?e:(f=b===ElementType.EMAIL||b===ElementType.FILE||b===ElementType.PHONE?getFallbackInputLabel:b===ElementType.TEXT?getFallbackTextLabel:b===ElementType.SELECT?getFallbackSelectLabel:getFallbackAttributeLabel,e=f(a,b),e)};function getElementType(a){var b,c=a.tagName.toLowerCase(),d=(a.getAttribute("type")||"").toLowerCase(),e=(a.getAttribute("role")||"").toLowerCase();switch(c){case"input":switch(d){case"button":case"submit":case"reset":b=ElementType.BUTTON;break;case"radio":b=ElementType.RADIO.break;case"checkbox":b=ElementType.CHECKBOX;break;case"image":b=ElementType.IMAGE;break;case"email":b=ElementType.EMAIL;break;case"file":b=ElementType.FILE;break;case"tel":b=ElementType.PHONE;break;case"hidden":b=ElementType.HIDDEN;break;case"text":case"password":case"search":case"number":case"week":case"url":default:b=ElementType.TEXT;}break;case"a":b=ElementType.ANCHOR;break;case"img":b=ElementType.IMAGE;break;case"select":b=ElementType.SELECT;break;case"radio":b=ElementType.RADIO;break;case"button":b=ElementType.BUTTON;break;case"textarea":b=ElementType.TEXT;break;default:b="textbox"===e?ElementType.TEXT:"radio"===e?ElementType.RADIO:"checkbox"===e?ElementType.CHECKBOX:"listbox"===e?ElementType.SELECT:"button"===e?ElementType.BUTTON:ElementType.OTHER;}return b}function getElementWrapper(a,b,c){var d=a.tagName.toLowerCase(),e="select"===d?"":textContent(a);if(c===LabelPreference.NONE&&""!==e)return a;if(c===LabelPreference.RIGHT||c===LabelPreference.LEFT)for(var f,g=getSiblings(a,c),h=0;h<g.length;h++)if(f=g[h],"select"!==f.tagName.toLowerCase()){if(_sibling=cloneAndClean(f),isValidLabel(textContent(_sibling)))return a;var j;if(c===LabelPreference.LEFT?j=getHeadText(f):c===LabelPreference.RIGHT&&(j=getTailText(f)),null!==j)return a}var k=a;do{if(c==LabelPreference.LEFT&&!isFirstSibling(k))return k;if(c==LabelPreference.RIGHT&&!isLastSibling(k))return k;k=k.parentElement}while(null!==k&&k!==b);return a}function isFirstSibling(a){var b=getSiblings(a,!0);if(0===b.length)return!0;for(var c,d=0;d<b.length;d++)if(c=b[d],"select"!==c.tagName.toLowerCase()&&isValidLabel(textContent(c)))return!1;return!0}function isLastSibling(a){var b=getSiblings(a,!1);if(0===b.length)return!0;for(var c,d=0;d<b.length;d++)if(c=b[d],"select"!==c.tagName.toLowerCase()&&isValidLabel(textContent(c)))return!1;return!0}function isFormElement(a){return a===ElementType.TEXT||a===ElementType.PHONE||a===ElementType.EMAIL||a===ElementType.FILE||a===ElementType.RADIO||a===ElementType.CHECKBOX||a===ElementType.SELECT}function getLabelPreference(a){if(a===ElementType.RADIO||a===ElementType.CHECKBOX)return LabelPreference.RIGHT;return a===ElementType.TEXT||a===ElementType.PHONE||a===ElementType.EMAIL||a===ElementType.FILE||a===ElementType.SELECT?LabelPreference.LEFT:LabelPreference.NONE}function isTemporaryLabel(a){return!(null!==a)||(a=a.trim(),""===a||/(?:required|mandatory|missing|error)/i.test(a))}function isValidLabel(a){return!a||(a=a.replace(PT_SKIP_CHARS,""),a=a.replace(PT_MULTISPACE," "),a=a.trim()),null!==a&&"undefined"!=typeof a&&""!==a}function isElementHidden(a){return null===a.offsetParent}function cloneAndClean(a,b){var c=a.cloneNode(!0);c.querySelectorAll("select").forEach(function(a){a!==c&&a!==b&&a.remove()});var d=[];return a.querySelectorAll("*").forEach(function(a){a!==c&&isElementHidden(a)&&d.push(a.outerHtml)}),c.querySelectorAll("*").forEach(function(a){0<d.length&&a.outerHtml===d[0]&&(a.remove(),d.shift())}),c}function getFirstAncestorByTagName(a,b){if(null===b||0===b.length)return null;for(var c=a.parentElement;null!==c;){if(0<=b.indexOf(c.tagName.toLowerCase()))return c;c=c.parentElement}return null}function getSiblings(a,b){for(var c=[];a=b?a.previousElementSibling:a.nextElementSibling;)a.nodeType===Node.ELEMENT_NODE&&c.push(a);return c}function textContent(a){return!a||!a instanceof Node?"":a.textContent.replace(PT_MULTISPACE," ").trim()}function getHeadText(a){var b=a&&a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE&&a.previousSibling.nodeValue&&a.previousSibling.nodeValue.trim();return!b?null:{text:b,element:null}}function getTailText(a){var b=a&&a.nextSibling&&a.nextSibling.nodeType===Node.TEXT_NODE&&a.nextSibling.nodeValue&&a.nextSibling.nodeValue.trim();return!b?null:{text:b,element:null}}function getToolTipLabel(a){for(var b=["alt","title"],c=0;c<b.length;c++)if(label=a.getAttribute(b[c]),null!==label)return{text:label.trim(),element:null};return null}function getAnchorLabel(a){var b=textContent(a);if(isValidLabel(b))return{text:b,element:null};var c=a.querySelector("img");if(null!==c){var d=getImageLabel(c);if(null!==d)return d}return getToolTipLabel(a)}function getButtonLabel(a){var b=textContent(a)||a.getAttribute("value");if(isValidLabel(b))return{text:b,element:null};var c=a.querySelector("img");if(null!==c){var d=getImageLabel(c);if(null!==d)return d}for(var e,f=0;f<a.children.length;f++){e=a.children[f];for(var g,h=0;h<e.classList.length;h++)if(g=e.classList[h],/(?:glyphicon|icon)\-/i.test(g)){var k=g.replace(/(?:glyphicon|icon)\-/ig,"").trim();if(!!k)return{text:k,element:null}}}var l="";try{l=a.getAttribute("type").toLowerCase()}catch(b){l=a.getAttribute("onclick"),l=l?l.split("(")[0].toLowerCase():l}return"submit"===l?{text:"Submit",element:null}:"reset"===l?{text:"Reset",element:null}:{text:l,element:null}}function getRadioLabel(a){var b=getTailText(a);return null===b?(b=getLabelFromSiblings(a,LabelPreference.RIGHT),null===b?getToolTipLabel(a):b):b}function getImageLabel(a){return getToolTipLabel(a)}function getAttributeLabel(a){for(var b=0;b<ATTRIBUTE_LABELS.length;b++){var c=ATTRIBUTE_LABELS[b],d=a.getAttribute(c);if(null!==d)return{text:d,element:null}}return null}function getFallbackTextLabel(a){for(var b,c=["placeholder","alt","title"],d=0;d<c.length;d++)if(b=a.getAttribute(c[d]),null!==b)return{text:b.trim(),element:null};if("search"===(a.getAttribute("type")||"").toLowerCase())return{text:"Search",element:null}}function getFallbackInputLabel(a,b){var c=getFallbackTextLabel(a);if(null!==c)return c;var d;return d=b===LabelPreference.EMAIL?"eMail":b===LabelPreference.FILE?"File":b===LabelPreference.PHONE?"Phone":null,null===d?d:{text:d,element:null}}function getFallbackSelectLabel(a){var b=getToolTipLabel(a);if(null!==b)return b;var c,d=a.tagName.toLowerCase(),e=(a.getAttribute("role")||"").toLowerCase();if("select"===d?c=a.querySelector("option[selected]")||a.querySelector("option"):"listbox"===e&&(c=a.querySelector("*[role=option][class~=selected]")||a.querySelector("*[role=option]")),null!==c){var f=textContent(c);if(isValidLabel(f)&&!/none/.test(f.toLowerCase()))return{text:f.replace(/\-/g,"").trim(),element:null}}return null}function getFallbackAttributeLabel(a){for(var b,c=["name","data-name"],d=0;d<c.length;d++)if(b=a.getAttribute(c[d]),null!==b)return{text:b.trim(),element:null};return null}function getLabelFromSiblings(a,b){var c,d,e;b===LabelPreference.LEFT?e=getSiblings(a,!0):b===LabelPreference.RIGHT?e=getSiblings(a,!1):b===LabelPreference.NONE&&(e=getSiblings(a,!0),e=e.concat(getSiblings(a,!1)));for(var f,g=0;g<e.length;g++){if(f=e[g],"label"===f.tagName.toLowerCase()&&!!!f.getAttribute("for")&&(c=textContent(f),isValidLabel(c)))return{text:c,element:f};var h=f.querySelector(SIBLING_LABEL_ELEMENTS);if(null!==h&&(c=textContent(cloneAndClean(h)),isValidLabel(c)))return{text:c,element:h}}for(var f,g=0;g<e.length;g++){if(f=e[g],d=b===LabelPreference.LEFT?getHeadText:b===LabelPreference.RIGHT?getTailText:null,xLabel=null!==d&&d(f),null!==xLabel)return xLabel;if(c=textContent(cloneAndClean(f)),isValidLabel(c))return{text:c,element:f}}return null}function getDirectLabelMap(){var a=new Map,b=this;return this.document.querySelectorAll(CSS_DIRECT_LABELS).forEach(function(c){var d,e,f=c.getAttribute("for");if(null!==f&&(d=b.document.getElementById(f),e=textContent(c),null!==d&&isValidLabel(e))){var g=getElementType(d);(g===ElementType.RADIO||g===ElementType.CHECKBOX)&&(k=getRadioLabel(d),e=null===k?null:k.text)}var h=c.getAttribute("aria-labelledby");if(null!==h){d=c,c=b.document.getElementById(h);for(var i=h.split(" "),j=i.length-1;null===c&&0<=j;)c=b.document.getElementById(i[j--]);e=textContent(c)}if(!!d&&!!e){var k={text:e,element:c};if(a.has(d)){var l=a[d];if(isTemporaryLabel(k.text)||isElementHidden(k.element))return;if(l&&l.text&&(isTemporaryLabel(l.text)||!isElementHidden(l.element)))return void a.set(d,k)}a.set(d,k)}}),a}